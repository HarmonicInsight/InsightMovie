# 動作確認手順書

InsightMovie の動作確認・テスト手順

## 概要

この手順書では、InsightMovieのインストールから音声生成までの一連の動作確認手順を説明します。

## テスト環境

### 推奨環境

- **OS**: Windows 10 64bit 以上
- **メモリ**: 4GB以上
- **ディスク空き容量**: 2GB以上
- **インターネット接続**: 初回セットアップ時に必要

### 準備

1. クリーンな Windows 環境（仮想マシン推奨）
2. インストーラー: `InsightMovie-Setup-1.0.0.exe`
3. テスト用テキスト（後述）

## テストシナリオ

### シナリオ1: 標準インストール（VOICEVOX自動セットアップ有り）

#### 1.1 インストール

**手順:**

1. `InsightMovie-Setup-1.0.0.exe` をダブルクリック
2. セットアップウィザードが起動
3. 「次へ」をクリック
4. ライセンス契約に同意
5. インストール先を確認（デフォルト: `C:\Program Files\InsightMovie`）
6. **重要**: 「VOICEVOX自動セットアップ」にチェックが入っていることを確認
7. 「次へ」をクリック
8. VOICEVOX利用規約への同意ページが表示される
9. 「VOICEVOXを公式から取得する旨の表示・リンク・規約確認導線」にチェック
10. 「次へ」をクリック
11. インストール開始
12. VOICEVOXのダウンロードが開始（進捗が表示される）
13. インストール完了
14. 「今すぐ起動」にチェックを入れて「完了」

**期待結果:**

- インストールが正常に完了する
- エラーメッセージが表示されない
- `%LOCALAPPDATA%\InsightMovie\voicevox\` にVOICEVOXがダウンロードされる
- アプリケーションが起動する

**確認コマンド:**

```cmd
dir "%LOCALAPPDATA%\InsightMovie\voicevox"
dir "%ProgramFiles%\InsightMovie"
```

#### 1.2 初回起動・セットアップウィザード

**手順:**

1. アプリケーションが起動すると、セットアップウィザードが表示される
2. ようこそページを確認
3. 「次へ」をクリック
4. VOICEVOXエンジン検出ページが表示される
5. 自動的にエンジンの検索が開始される
6. 「✓ エンジンが見つかりました！」と表示されることを確認
7. 表示されるURL（例: `http://127.0.0.1:50021`）を確認
8. 「次へ」をクリック
9. デフォルト話者設定ページが表示される
10. 「✓ 「青山流星」を設定しました」と表示されることを確認
11. 「次へ」をクリック
12. セットアップ完了ページが表示される
13. 「完了」をクリック

**期待結果:**

- ウィザードがスムーズに進行する
- VOICEVOXエンジンが自動検出される
- 「青山流星」が自動選択される
- エラーが発生しない

#### 1.3 メイン画面確認

**手順:**

1. メイン画面が表示される
2. 画面上部に「✓ VOICEVOXエンジン接続中」と緑色で表示されることを確認
3. テキスト入力エリアが表示されることを確認
4. 「音声を生成」ボタンが表示されることを確認
5. ログエリアが表示されることを確認

**期待結果:**

- メイン画面が正常に表示される
- エンジン接続状態が「接続中」になっている

#### 1.4 音声生成テスト

**テストケース1: 基本的な音声生成**

**手順:**

1. テキスト入力エリアに以下を入力:
   ```
   こんにちは、InsightMovieです。
   ```
2. 「音声を生成」ボタンをクリック
3. ログに「音声生成開始」と表示される
4. 数秒待つ
5. ログに「✓ 音声生成完了」と表示される
6. 「WAVファイルとして保存」ボタンが有効になる

**期待結果:**

- 音声生成が正常に完了する
- エラーが発生しない
- 生成時間が妥当（テキスト長に応じて数秒程度）

**テストケース2: WAVファイル保存**

**手順:**

1. 「WAVファイルとして保存」ボタンをクリック
2. ファイル保存ダイアログが表示される
3. 保存先を選択（例: デスクトップ）
4. ファイル名を入力（例: `test_output.wav`）
5. 「保存」をクリック
6. 「✓ 保存完了」と表示される
7. 保存したWAVファイルをWindows Media Playerなどで再生

**期待結果:**

- ファイルが正常に保存される
- 保存したWAVファイルが再生できる
- 音声が正しく合成されている（入力テキストと一致）

**テストケース3: 長文テキスト**

**手順:**

1. 以下の長文を入力:
   ```
   これは音声合成のテストです。
   長い文章でも正しく音声が生成されるか確認します。
   複数の文を含む場合の動作も確認が必要です。
   問題なく動作することを期待しています。
   ```
2. 「音声を生成」ボタンをクリック
3. 生成完了を待つ
4. WAVファイルとして保存

**期待結果:**

- 長文でも正常に生成される
- メモリエラーが発生しない
- 音声の品質が維持されている

### シナリオ2: エンジンが起動していない場合

#### 2.1 エンジン停止状態でアプリ起動

**準備:**

1. VOICEVOXエンジンを手動で停止（タスクマネージャーで終了）
2. アプリケーションを再起動

**手順:**

1. アプリケーションを起動
2. セットアップウィザードのエンジン検出ページで「✗ エンジンが見つかりませんでした」と表示される
3. 「エンジンを起動」ボタンが有効になる
4. 「エンジンを起動」ボタンをクリック
5. 「エンジンを起動中...」と表示される
6. 数秒後、「再検索」が自動的に実行される
7. 「✓ エンジンが見つかりました！」と表示される

**期待結果:**

- エンジン起動ボタンが正常に動作する
- エンジンが起動される
- 再検索で検出される

#### 2.2 手動設定

**手順:**

1. セットアップウィザードのエンジン検出ページで「手動設定」ボタンをクリック
2. ファイル選択ダイアログが表示される
3. VOICEVOXの `run.exe` を選択（例: `%LOCALAPPDATA%\InsightMovie\voicevox\run.exe`）
4. 「エンジンのパス: ...」と表示される
5. 「エンジンを起動」ボタンをクリック
6. エンジンが起動される

**期待結果:**

- 手動でエンジンパスを設定できる
- 設定したパスでエンジンが起動する

### シナリオ3: オフライン環境

#### 3.1 インストール（VOICEVOX自動セットアップなし）

**準備:**

- ネットワーク接続を無効化

**手順:**

1. インストーラーを実行
2. 「VOICEVOX自動セットアップ」のチェックを**外す**
3. インストールを続行
4. インストール完了

**期待結果:**

- VOICEVOXなしでもアプリがインストールできる
- エラーが発生しない

#### 3.2 手動VOICEVOX配置

**準備:**

1. 別のPCでVOICEVOXエンジンをダウンロード
2. USBメモリなどで転送

**手順:**

1. ダウンロードしたVOICEVOX ZIPファイルを展開
2. 展開したフォルダを `%LOCALAPPDATA%\InsightMovie\voicevox\` に配置
3. アプリケーションを起動
4. セットアップウィザードでエンジンが検出される

**期待結果:**

- 手動配置したVOICEVOXが検出される
- 正常に音声生成できる

### シナリオ4: ポート変更

#### 4.1 カスタムポートでエンジン起動

**手順:**

1. コマンドプロンプトを開く
2. 以下を実行:
   ```cmd
   cd %LOCALAPPDATA%\InsightMovie\voicevox
   run.exe --port=50050
   ```
3. アプリケーションを起動
4. セットアップウィザードが自動的にポートスキャンを実行
5. ポート50050でエンジンが検出される

**期待結果:**

- デフォルト以外のポートでも検出される
- 正常に接続できる

## 回帰テスト

新しいバージョンをリリースする際の回帰テストチェックリスト:

### インストール

- [ ] 新規インストールが正常に完了する
- [ ] VOICEVOX自動セットアップが動作する
- [ ] デスクトップアイコンが作成される
- [ ] スタートメニューに登録される

### 初回起動

- [ ] セットアップウィザードが表示される
- [ ] VOICEVOXエンジン自動検出が動作する
- [ ] 「青山流星」が自動選択される
- [ ] セットアップが正常に完了する

### 音声生成

- [ ] 短文の音声生成が動作する
- [ ] 長文の音声生成が動作する
- [ ] WAVファイル保存が動作する
- [ ] 保存したWAVファイルが再生できる

### エラーハンドリング

- [ ] エンジン未起動時に適切なエラーメッセージが表示される
- [ ] エンジン起動ボタンが動作する
- [ ] 手動設定が動作する
- [ ] 再検索が動作する

### アンインストール

- [ ] アンインストールが正常に完了する
- [ ] アプリケーションファイルが削除される
- [ ] スタートメニューから削除される
- [ ] （オプション）VOICEVOXファイルの削除確認が表示される

## 既知の問題

### ポート競合

**現象:** エンジンが既に起動しているが検出されない

**原因:** 別のアプリケーションがポート50021を使用している

**対処:** ポートスキャン機能により自動的に他のポートを検出

### ファイアウォール

**現象:** エンジンに接続できない

**原因:** Windowsファイアウォールがブロックしている

**対処:** 初回起動時にファイアウォール許可ダイアログが表示される

## テスト結果記録

### テスト実施日: YYYY-MM-DD

| シナリオ | 結果 | 備考 |
|---------|------|------|
| シナリオ1: 標準インストール | ✓ / ✗ | |
| シナリオ2: エンジン未起動 | ✓ / ✗ | |
| シナリオ3: オフライン環境 | ✓ / ✗ | |
| シナリオ4: ポート変更 | ✓ / ✗ | |

### テスト環境

- OS: Windows XX (build XXXXX)
- メモリ: XX GB
- ビルド番号: vX.X.X
- テスター: [名前]

### 発見された問題

1. [問題の説明]
   - 再現手順: [手順]
   - 期待結果: [期待される動作]
   - 実際の結果: [実際の動作]
   - 優先度: [高/中/低]

## まとめ

この手順書に従って動作確認を実施することで、InsightMovieの品質を保証できます。

問題が発見された場合は、GitHub Issuesで報告してください。
